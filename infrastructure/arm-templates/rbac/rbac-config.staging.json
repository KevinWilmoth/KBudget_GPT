{
  "description": "RBAC configuration for Staging environment",
  "environment": "staging",
  "roleAssignments": [
    {
      "principalType": "Group",
      "principalIdentifier": "KBudget-DevOps",
      "role": "Contributor",
      "scope": {
        "type": "ResourceGroup",
        "name": "kbudget-staging-rg"
      },
      "justification": "DevOps team manages staging environment for release validation"
    },
    {
      "principalType": "Group",
      "principalIdentifier": "KBudget-QA",
      "role": "Reader",
      "scope": {
        "type": "ResourceGroup",
        "name": "kbudget-staging-rg"
      },
      "justification": "QA team validates staging deployments"
    },
    {
      "principalType": "Group",
      "principalIdentifier": "KBudget-Developers",
      "role": "Reader",
      "scope": {
        "type": "ResourceGroup",
        "name": "kbudget-staging-rg"
      },
      "justification": "Developers need read-only access to troubleshoot staging issues"
    },
    {
      "principalType": "ServicePrincipal",
      "principalIdentifier": "kbudget-staging-automation",
      "role": "Contributor",
      "scope": {
        "type": "ResourceGroup",
        "name": "kbudget-staging-rg"
      },
      "justification": "CI/CD pipeline service principal for automated deployments"
    },
    {
      "principalType": "ServicePrincipal",
      "principalIdentifier": "kbudget-staging-app",
      "role": "Storage Blob Data Contributor",
      "scope": {
        "type": "StorageAccount",
        "name": "kbudgetstagingstorage"
      },
      "justification": "App Service managed identity needs to read/write blob data"
    },
    {
      "principalType": "ServicePrincipal",
      "principalIdentifier": "kbudget-staging-app",
      "role": "Key Vault Secrets User",
      "scope": {
        "type": "KeyVault",
        "name": "kbudget-staging-kv"
      },
      "justification": "App Service managed identity needs to read secrets from Key Vault"
    },
    {
      "principalType": "ServicePrincipal",
      "principalIdentifier": "kbudget-staging-func",
      "role": "Storage Blob Data Contributor",
      "scope": {
        "type": "StorageAccount",
        "name": "kbudgetstagingstorage"
      },
      "justification": "Azure Functions managed identity needs to process blob data"
    },
    {
      "principalType": "ServicePrincipal",
      "principalIdentifier": "kbudget-staging-func",
      "role": "Key Vault Secrets User",
      "scope": {
        "type": "KeyVault",
        "name": "kbudget-staging-kv"
      },
      "justification": "Azure Functions managed identity needs to read secrets"
    },
    {
      "principalType": "Group",
      "principalIdentifier": "KBudget-Security-Team",
      "role": "Security Reader",
      "scope": {
        "type": "ResourceGroup",
        "name": "kbudget-staging-rg"
      },
      "justification": "Security team audits security configurations"
    }
  ]
}
